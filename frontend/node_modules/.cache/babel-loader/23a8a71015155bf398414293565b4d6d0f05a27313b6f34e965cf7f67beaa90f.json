{"ast":null,"code":"import _objectSpread from\"C:/Users/as999/Desktop/Flight/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import{useBooking}from'../context/BookingContext';import{useNavigate}from'react-router-dom';import{supabase}from'../supabaseClient';import{useAuth}from'../hooks/useAuth';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BookingForm=()=>{const{selectedFlight,setBookingData}=useBooking();const user=useAuth();const navigate=useNavigate();const[formData,setFormData]=useState({passenger_name:'',email:'',phone:'',seat_number:''});const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[showThankYou,setShowThankYou]=useState(false);const handleSubmit=async e=>{e.preventDefault();if(!selectedFlight){setError('Please select a flight first');return;}setLoading(true);setError(null);setShowThankYou(false);try{// 1. Create booking record\nconst{data:bookingRecord,error:bookingError}=await supabase.from('bookings').insert([{user_id:user.id,flight_number:selectedFlight.flight_number,airline_name:selectedFlight.airline_name,origin:selectedFlight.origin,destination:selectedFlight.destination,departure_time:selectedFlight.departure_time,arrival_time:selectedFlight.arrival_time,price:selectedFlight.price,seat_number:formData.seat_number,passenger_name:formData.passenger_name,passenger_email:formData.email,passenger_phone:formData.phone,booking_date:new Date().toISOString(),status:'confirmed',created_at:new Date().toISOString()}]).select().single();if(bookingError)throw bookingError;setBookingData(bookingRecord);setShowThankYou(true);// Update user's profile with booking count\nconst{error:profileError}=await supabase.from('profiles').update({total_bookings:supabase.rpc('increment',{x:1}),updated_at:new Date().toISOString()}).eq('id',user.id);if(profileError)console.error('Error updating profile:',profileError);setTimeout(()=>{setShowThankYou(false);setBookingData(null);setFormData({passenger_name:'',email:'',phone:'',seat_number:''});navigate('/');},3000);}catch(err){console.error('Booking error:',err);setError(err.message||'Failed to create booking. Please try again.');}finally{setLoading(false);}};if(!selectedFlight){return null;}if(showThankYou){return/*#__PURE__*/_jsxs(\"div\",{className:\"thank-you-message\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Thanks for booking with us!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Redirecting you to the home page...\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"booking-form\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Book Flight\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flight-details\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Flight: \",selectedFlight.flight_number]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Airline: \",selectedFlight.airline_name]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"From: \",selectedFlight.origin,\" to \",selectedFlight.destination]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Price: $\",selectedFlight.price]})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Seat Number\",value:formData.seat_number,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{seat_number:e.target.value})),required:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Passenger Name\",value:formData.passenger_name,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{passenger_name:e.target.value})),required:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"email\",placeholder:\"Email\",value:formData.email,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{email:e.target.value})),required:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"tel\",placeholder:\"Phone Number\",value:formData.phone,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{phone:e.target.value})),required:true})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,children:loading?'Processing...':'Confirm Booking'})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error})]});};export default BookingForm;","map":{"version":3,"names":["React","useState","useBooking","useNavigate","supabase","useAuth","jsx","_jsx","jsxs","_jsxs","BookingForm","selectedFlight","setBookingData","user","navigate","formData","setFormData","passenger_name","email","phone","seat_number","loading","setLoading","error","setError","showThankYou","setShowThankYou","handleSubmit","e","preventDefault","data","bookingRecord","bookingError","from","insert","user_id","id","flight_number","airline_name","origin","destination","departure_time","arrival_time","price","passenger_email","passenger_phone","booking_date","Date","toISOString","status","created_at","select","single","profileError","update","total_bookings","rpc","x","updated_at","eq","console","setTimeout","err","message","className","children","onSubmit","type","placeholder","value","onChange","_objectSpread","target","required","disabled"],"sources":["C:/Users/as999/Desktop/Flight/frontend/src/components/BookingForm.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { useBooking } from '../context/BookingContext';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '../supabaseClient';\nimport { useAuth } from '../hooks/useAuth';\n\nconst BookingForm = () => {\n  const { selectedFlight, setBookingData } = useBooking();\n  const user = useAuth();\n  const navigate = useNavigate();\n  const [formData, setFormData] = useState({\n    passenger_name: '',\n    email: '',\n    phone: '',\n    seat_number: ''\n  });\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [showThankYou, setShowThankYou] = useState(false);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!selectedFlight) {\n      setError('Please select a flight first');\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n    setShowThankYou(false);\n\n    try {\n      // 1. Create booking record\n      const { data: bookingRecord, error: bookingError } = await supabase\n        .from('bookings')\n        .insert([\n          {\n            user_id: user.id,\n            flight_number: selectedFlight.flight_number,\n            airline_name: selectedFlight.airline_name,\n            origin: selectedFlight.origin,\n            destination: selectedFlight.destination,\n            departure_time: selectedFlight.departure_time,\n            arrival_time: selectedFlight.arrival_time,\n            price: selectedFlight.price,\n            seat_number: formData.seat_number,\n            passenger_name: formData.passenger_name,\n            passenger_email: formData.email,\n            passenger_phone: formData.phone,\n            booking_date: new Date().toISOString(),\n            status: 'confirmed',\n            created_at: new Date().toISOString()\n          }\n        ])\n        .select()\n        .single();\n\n      if (bookingError) throw bookingError;\n\n      setBookingData(bookingRecord);\n      setShowThankYou(true);\n\n      // Update user's profile with booking count\n      const { error: profileError } = await supabase\n        .from('profiles')\n        .update({ \n          total_bookings: supabase.rpc('increment', { x: 1 }),\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', user.id);\n\n      if (profileError) console.error('Error updating profile:', profileError);\n\n      setTimeout(() => {\n        setShowThankYou(false);\n        setBookingData(null);\n        setFormData({\n          passenger_name: '',\n          email: '',\n          phone: '',\n          seat_number: ''\n        });\n        navigate('/');\n      }, 3000);\n\n    } catch (err) {\n      console.error('Booking error:', err);\n      setError(err.message || 'Failed to create booking. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!selectedFlight) {\n    return null;\n  }\n\n  if (showThankYou) {\n    return (\n      <div className=\"thank-you-message\">\n        <h2>Thanks for booking with us!</h2>\n        <p>Redirecting you to the home page...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"booking-form\">\n      <h2>Book Flight</h2>\n      <div className=\"flight-details\">\n        <p>Flight: {selectedFlight.flight_number}</p>\n        <p>Airline: {selectedFlight.airline_name}</p>\n        <p>From: {selectedFlight.origin} to {selectedFlight.destination}</p>\n        <p>Price: ${selectedFlight.price}</p>\n      </div>\n\n      <form onSubmit={handleSubmit}>\n        <div className=\"form-group\">\n          <input\n            type=\"text\"\n            placeholder=\"Seat Number\"\n            value={formData.seat_number}\n            onChange={(e) => setFormData({ ...formData, seat_number: e.target.value })}\n            required\n          />\n        </div>\n        <div className=\"form-group\">\n          <input\n            type=\"text\"\n            placeholder=\"Passenger Name\"\n            value={formData.passenger_name}\n            onChange={(e) => setFormData({ ...formData, passenger_name: e.target.value })}\n            required\n          />\n        </div>\n        <div className=\"form-group\">\n          <input\n            type=\"email\"\n            placeholder=\"Email\"\n            value={formData.email}\n            onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n            required\n          />\n        </div>\n        <div className=\"form-group\">\n          <input\n            type=\"tel\"\n            placeholder=\"Phone Number\"\n            value={formData.phone}\n            onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n            required\n          />\n        </div>\n        <button type=\"submit\" disabled={loading}>\n          {loading ? 'Processing...' : 'Confirm Booking'}\n        </button>\n      </form>\n\n      {error && (\n        <div className=\"error-message\">\n          {error}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default BookingForm; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}